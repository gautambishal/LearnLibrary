#!/bin/bash
echo "$war_list  $restart_tomcat $tomcat $host $branch  $JOB_NAME   $JOB_BASE_NAME  $WORKSPACE"

ping -c 3 $host

branch=`echo $branch | sed 's#origin/##' `
workdir=work_build
commit=`git rev-parse --short HEAD`

##app_dir APP目录名称
src_build=$1
app_dir=$2
job=$JOB_NAME
upload=/home/geektest/$scp_dir

##variable.tmp用于两个不同脚本之间的变量传递
echo "scp_dir=$scp_dir" > variable.tmp
echo "file_path=$upload/${app_dir}.tar.gz" >> variable.tmp
echo "app_dir=$app_dir" >> variable.tmp


##删除之前的构建记录
rm -rf  $workdir
mkdir -p  $workdir 

##复制原文件到工作目录(构建名称与目标目录不同时，重命名，例如，build  --> mantis_build)
echo "复制到工作目录： cp -a $src_build $workdir/$app_dir"
cp -a $src_build $workdir/$app_dir
cd $workdir

echo "压缩 打包"
tar czf ${app_dir}.tar.gz $app_dir                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                


#推送到远程主机
conf_file=version.conf


function push_file {
	echo "推送到远程"
    ssh $host -p40001 "mkdir -p $upload"
    scp -P40001 ${app_dir}.tar.gz  $host:$upload
}

function uncompress_file {
	echo "解压缩"
    ssh $host -p40001 "tar xf $upload/${app_dir}.tar.gz"
    
}
push_file

uncompress_file


